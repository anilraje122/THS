<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="main.css"/>
</head>
<body>
    <header>
        <div class="container">
            <i class="fas fa-cloud-sun fa-3x"></i><h1>Weather App</h1>
        </div>
    </header>
    <div class="container">
        <div class="app-container">
            <div class="search-bar">
                <i class="fa fa-search" aria-hidden="true"></i>
                <input id="inputCity" type="text" placeholder="Search city"/>
            </div>
            <button id="btn" onclick="weatherApp();">Get Weather</button>
            <div id="outputContainer">
                <div class="outputCard">
                   
                    <div class="outputCardLeft">
                        <div>
                            Current Weather in 
                        </div>
                        <div class="moreDetails">
                            <span class="label" id="city">City</span>
                        </div>
                        <div class="moreDetails">
                            <span class="label" id="temp">temp</span>
                        </div>
                        <div class="moreDetails">
                            <span class="label" id="desc">description</span>
                        </div>
                        <div class="moreDetails">
                            <span class="label" id="time">time</span>
                        </div>
                    </div>
                    <div class="outputCardRight">
                        <div class="moreDetails">
                            <span class="label">Feels Like</span>
                            <span class="value" id="feelslike"></span>
                        </div>
                        <div class="moreDetails">
                            <span class="label">Min Temp</span>
                            <span class="value" id="minTemp"></span>
                        </div>
                        <div class="moreDetails">
                            <span class="label">Max Temp</span>
                            <span class="value" id="maxTemp"></span>
                        </div>
                        <div class="moreDetails">
                            <span class="label">Humidity</span>
                            <span class="value" id="humid"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>
            Copyright &copy; <script>document.write(new Date().getFullYear());</script> anilraj.space. All Rights Reserved. 
        </p>
    </footer>
</body>
<script>
    const apiKey = '4efbc48122728ba2934e037dec910a10';
    const baseUrl = `http://api.openweathermap.org/data/2.5/weather?q=`;

    const getCityWeather = (cityName) => {
        const fullUrl = `${baseUrl}${cityName}&appid=${apiKey}`
        return axios.get(fullUrl);
    }

    function weatherApp() {
        const cityName = document.getElementById('inputCity').value;
        getCityWeather(cityName)
        .then((res)=> {
            let d = new Date();
            let curTime = `${d.getHours()}:${d.getMinutes()}`;
            let curDate = 
            curTime = convertTime24to12(curTime);
            const temp = (res.data.main.temp - 273.15).toFixed(2) + "&#8451;";
            const desc = res.data.weather[0].description;
            const humidity = res.data.main.humidity;
            const feelslike = (res.data.main.feels_like - 273.15).toFixed(2) + "&#8451;";
            const minTemp = (res.data.main.temp_min - 273.15).toFixed(2) + "&#8451;";
            const maxTemp = (res.data.main.temp_max - 273.15).toFixed(2) + "&#8451;";
            document.getElementById('outputContainer').style.display = "block";
            console.log(cityName, curTime, temp, desc, feelslike, minTemp, maxTemp, humidity);
            document.getElementById('city').innerText = cityName;
            document.getElementById('time').innerText = curTime;
            document.getElementById('temp').innerHTML = temp;
            document.getElementById('desc').innerText = `${desc}`;
            document.getElementById('feelslike').innerHTML = feelslike;
            document.getElementById('minTemp').innerHTML = minTemp;
            document.getElementById('maxTemp').innerHTML = maxTemp;
            document.getElementById('humid').innerText = humidity;
        })
        .catch((err)=> {
            document.getElementById('outputContainer').innerText = "Error Occured!";
            console.log(err);
        })
    }

    convertTime24to12 = (curTime) => {
        let hh = curTime.split(':')[0];
        if( hh == 12) {
            return curTime + " PM";
        }
        else if(hh > 12) {
            hh = hh - 12;
            return hh + ":" + curTime.split(':')[1] + " PM";
        } else {
            return curTime + " AM";
        }
    }
</script>
</html>